<!DOCTYPE html>
<html lang="en">
<head>
          <title>jonathanhood.org</title>
        <meta charset="utf-8" />




</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="./">jonathanhood.org <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="./pages/about-me.html">About Me</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="./email-with-python.html" rel="bookmark"
         title="Permalink to How-To Send Email with Python">How-To Send Email with Python</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2011-01-30T00:00:00">
      Sun 30 January 2011
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="./author/jonathan.html">jonathan</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>Sending email from a script is a very useful tool. On a linux machine, you can setup a mta to get mail from any cron jobs, but there are alot of situations where that functionality may not be available. This happened to me the other day, and I found the fantastic smtplib that exists in the python standard library. So, you need to send a message? Its super easy, first import smtplib and connect to a server</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">smtplib</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span> <span class="s">&quot;your.smtp.address&quot;</span> <span class="p">)</span>
</pre></div>
<p>At this point there may or may not be a few extra steps to perform. My test server is configured for STARTTLS and authentication. I'll detail the steps for that here.</p>
<div class="highlight"><pre><span class="n">server</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>
<span class="n">server</span><span class="o">.</span><span class="n">ehlo</span><span class="p">()</span>
<span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">(</span> <span class="s">&quot;username&quot;</span><span class="p">,</span> <span class="s">&quot;password&quot;</span> <span class="p">)</span>
</pre></div>
<p>Now, build your message. The primary downside to smtplib is that you have to build the header yourself. As it turns out, that is pretty trivial.</p>
<div class="highlight"><pre><span class="n">mailto</span> <span class="o">=</span> <span class="s">&quot;test.email@foo.com&quot;</span>
<span class="n">mailfrom</span> <span class="o">=</span> <span class="s">&quot;otheremail@foo.com&quot;</span>
<span class="n">subject</span> <span class="o">=</span> <span class="s">&quot;Test Email&quot;</span>
<span class="n">head</span> <span class="o">=</span> <span class="s">&quot;From: &quot;</span> <span class="o">+</span> <span class="n">mailfrom</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\r\n</span><span class="s">To: &quot;</span> <span class="o">+</span> <span class="n">mailto</span>
     <span class="o">+</span> <span class="s">&quot;</span><span class="se">\r\n</span><span class="s">Subject: &quot;</span> <span class="o">+</span> <span class="n">subject</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\r\n\r\n</span><span class="s">&quot;</span>
</pre></div>
<p>The rest of the message is just plain text.</p>
<div class="highlight"><pre><span class="n">body</span> <span class="o">=</span> <span class="s">&quot;Hello world!&quot;</span>
</pre></div>
<p>Now, put the two together and send the message.</p>
<div class="highlight"><pre><span class="n">msg</span> <span class="o">=</span> <span class="n">head</span> <span class="o">+</span> <span class="n">body</span>
<span class="n">server</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span> <span class="n">mailfrom</span><span class="p">,</span> <span class="n">mailto</span><span class="p">,</span> <span class="n">msg</span> <span class="p">)</span>
</pre></div>
<p>I wrote a function to encapsulate this behavior, maybe it will be useful for you.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">sendEmail</span><span class="p">(</span> <span class="n">mailfrom</span><span class="p">,</span> <span class="n">mailto</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">servername</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span> <span class="p">):</span>
  <span class="kn">import</span> <span class="nn">smtplib</span>
  <span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span> <span class="n">servername</span> <span class="p">)</span>
  <span class="n">server</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>
  <span class="n">server</span><span class="o">.</span><span class="n">ehlo</span><span class="p">()</span>
  <span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">(</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span> <span class="p">)</span>
  <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;From: &quot;</span> <span class="o">+</span> <span class="n">mailfrom</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\r\n</span><span class="s">To: &quot;</span> <span class="o">+</span> <span class="n">mailto</span>
        <span class="o">+</span> <span class="s">&quot;</span><span class="se">\r\n</span><span class="s">Subject: &quot;</span> <span class="o">+</span> <span class="n">subject</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\r\n\r\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">body</span>
  <span class="n">server</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span> <span class="n">mailfrom</span><span class="p">,</span> <span class="n">mailto</span><span class="p">,</span> <span class="n">msg</span> <span class="p">)</span>
</pre></div>

  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>